CREATE DATABASE Vbeat;
USE Vbeat;

CREATE TABLE `User`(
    id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT 
    ,email VARCHAR(100) NOT NULL
    ,loginPw VARCHAR(255) NULL
    ,nickName VARCHAR(50) NOT NULL
    ,loginType TINYINT NOT NULL DEFAULT 0 COMMENT '0=일반, 1=카카오, 2=구글'
    ,regDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
    ,profileImg VARCHAR(255) NULL
    ,UNIQUE KEY (email)CREATE DATABASE Vbeat;
USE Vbeat;

CREATE TABLE `User`(
    id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT 
    ,email VARCHAR(100) NOT NULL
    ,loginPw VARCHAR(255) NULL
    ,nickName VARCHAR(50) NOT NULL
    ,loginType TINYINT NOT NULL DEFAULT 0 COMMENT '0=일반, 1=카카오, 2=구글'
    ,regDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
    ,profileImg VARCHAR(255) NULL
    ,UNIQUE KEY (email)
    ,UNIQUE KEY (nickName)
);


# 추후 컬럼 수정 
CREATE TABLE Message (
    id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT 
    ,channelId INT UNSIGNED NOT NULL 
    ,userId  INT UNSIGNED
    ,content TEXT NOT NULL 
    ,`type` INT UNSIGNED DEFAULT 0 # 0=일반, 1=시스템, 2=파일, 3=Git, 4=코드
    ,regDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
    ,FOREIGN KEY (channelId) REFERENCES `Channel`(id) ON DELETE CASCADE
    ,FOREIGN KEY (userId) REFERENCES `User`(id) ON DELETE SET NULL
)


CREATE TABLE song(
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(100) NOT NULL,
    file_path VARCHAR(500) NULL,
    create_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);

SELECT * FROM song;
CREATE TABLE note(
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    song_id BIGINT UNSIGNED NOT NULL,
    `type` ENUM('tap', 'long') NOT NULL DEFAULT 'tap',
    end_time DECIMAL(10,3) NULL,
    note_time DECIMAL(10,3) NOT NULL,
    lane TINYINT UNSIGNED NOT NULL,
    create_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_song_time (song_id, note_time),
    INDEX idx_song_lane_time(song_id, lane, note_time)
);
    ,UNIQUE KEY (nickName)
);


# 추후 컬럼 수정 
CREATE TABLE Message (
    id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT 
    ,channelId INT UNSIGNED NOT NULL 
    ,userId  INT UNSIGNED
    ,content TEXT NOT NULL 
    ,`type` INT UNSIGNED DEFAULT 0 # 0=일반, 1=시스템, 2=파일, 3=Git, 4=코드
    ,regDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
    ,FOREIGN KEY (channelId) REFERENCES `Channel`(id) ON DELETE CASCADE
    ,FOREIGN KEY (userId) REFERENCES `User`(id) ON DELETE SET NULL
)


CREATE TABLE song(
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(100) NOT NULL,
    file_path VARCHAR(500) NULL,
    create_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    diff VARCHAR(10) NOT NULL DEFAULT 'easy'
);
SELECT * FROM song;


CREATE TABLE note(
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    song_id BIGINT UNSIGNED NOT NULL,
    note_time DECIMAL(10,3) NOT NULL,
    lane TINYINT UNSIGNED NOT NULL,
    `type` ENUM('tap', 'long') NOT NULL DEFAULT 'tap',
    end_time DECIMAL(10, 3) NULL,
    create_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_song_time (song_id, note_time),
    INDEX idx_song_end (song_id, end_time)
);

SELECT * FROM note;